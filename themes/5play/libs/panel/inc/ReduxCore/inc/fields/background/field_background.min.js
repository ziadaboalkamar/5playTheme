(function(a){redux.field_objects=redux.field_objects||{};redux.field_objects.background=redux.field_objects.background||{};redux.field_objects.background.init=function(b){if(!b){b=a(document).find(".redux-group-tab:visible").find(".redux-container-background:visible")}a(b).each(function(){var g=a(this);var f=g;if(!g.hasClass("redux-field-container")){f=g.parents(".redux-field-container:first")}if(f.is(":hidden")){return}if(f.hasClass("redux-field-init")){f.removeClass("redux-field-init")}else{return}g.find(".redux-remove-background").unbind("click").on("click",function(h){h.preventDefault();redux.field_objects.background.removeImage(a(this).parents(".redux-container-background:first"));return false});g.find(".redux-background-upload").unbind().on("click",function(h){redux.field_objects.background.addImage(h,a(this).parents(".redux-container-background:first"))});g.find(".redux-background-input").on("change",function(){redux.field_objects.background.preview(a(this))});g.find(".redux-color").wpColorPicker({change:function(i,h){a(this).val(h.color.toString());redux_change(a(this));a("#"+i.target.id+"-transparency").removeAttr("checked");redux.field_objects.background.preview(a(this))},clear:function(i,h){a(this).val(h.color.toString());redux_change(a(this).parent().find(".redux-color-init"));redux.field_objects.background.preview(a(this))}});g.find(".redux-color").on("blur",function(){var h=a(this).val();var i="#"+a(this).attr("id");if(h==="transparent"){a(this).parent().parent().find(".wp-color-result").css("background-color","transparent");g.find(i+"-transparency").attr("checked","checked")}else{if(colorValidate(this)===h){if(h.indexOf("#")!==0){a(this).val(a(this).data("oldcolor"))}}g.find(i+"-transparency").removeAttr("checked")}});g.find(".redux-color").on("focus",function(){a(this).data("oldcolor",a(this).val())});g.find(".redux-color").on("keyup",function(){var i=a(this).val();var h=colorValidate(this);var j="#"+a(this).attr("id");if(i==="transparent"){a(this).parent().parent().find(".wp-color-result").css("background-color","transparent");g.find(j+"-transparency").attr("checked","checked")}else{g.find(j+"-transparency").removeAttr("checked");if(h&&h!==a(this).val()){a(this).val(h)}}});g.find(".color-transparency").on("click",function(){if(a(this).is(":checked")){g.find(".redux-saved-color").val(a("#"+a(this).data("id")).val());g.find("#"+a(this).data("id")).val("transparent");g.find("#"+a(this).data("id")).parent().parent().find(".wp-color-result").css("background-color","transparent")}else{if(g.find("#"+a(this).data("id")).val()==="transparent"){var h=a(".redux-saved-color").val();if(h===""){h=a("#"+a(this).data("id")).data("default-color")}g.find("#"+a(this).data("id")).parent().parent().find(".wp-color-result").css("background-color",h);g.find("#"+a(this).data("id")).val(h)}}redux.field_objects.background.preview(a(this));redux_change(a(this))});var c={width:"resolve",triggerChange:true,allowClear:true};var d=g.find(".select2_params");if(d.size()>0){var e=d.val();e=JSON.parse(e);c=a.extend({},c,e)}g.find(" .redux-background-repeat, .redux-background-clip, .redux-background-origin, .redux-background-size, .redux-background-attachment, .redux-background-position").select2(c)})};redux.field_objects.background.preview=function(b){var e=a(b).parents(".redux-container-background:first");var f=a(e).find(".background-preview");if(!f){return}var d=true;var c="height:"+f.height()+"px;";a(e).find(".redux-background-input").each(function(){var g=a(this).serializeArray();g=g[0];if(g&&g.name.indexOf("[background-")!=-1){if(g.value!==""){d=false;g.name=g.name.split("[background-");g.name="background-"+g.name[1].replace("]","");if(g.name=="background-image"){c+=g.name+':url("'+g.value+'");'}else{c+=g.name+":"+g.value+";"}}}});if(!d){f.attr("style",c).fadeIn()}else{f.slideUp()}};redux.field_objects.background.addImage=function(d,b){d.preventDefault();var e;var c=a(this);if(e){e.open();return}e=wp.media({multiple:false,library:{},title:c.data("choose"),button:{text:c.data("update")}});e.on("select",function(){var j=e.state().get("selection").first();e.close();if(j.attributes.type!=="image"){return}b.find(".upload").val(j.attributes.url);b.find(".upload-id").val(j.attributes.id);b.find(".upload-height").val(j.attributes.height);b.find(".upload-width").val(j.attributes.width);redux_change(a(b).find(".upload-id"));var i=j.attributes.url;if(typeof j.attributes.sizes!=="undefined"&&typeof j.attributes.sizes.thumbnail!=="undefined"){i=j.attributes.sizes.thumbnail.url}else{if(typeof j.attributes.sizes!=="undefined"){var f=j.attributes.height;for(var h in j.attributes.sizes){var g=j.attributes.sizes[h];if(g.height<f){f=g.height;i=g.url}}}else{i=j.attributes.icon}}b.find(".upload-thumbnail").val(i);if(!b.find(".upload").hasClass("noPreview")){b.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+i+'">').slideDown("fast")}b.find(".redux-remove-background").removeClass("hide");b.find(".redux-background-input-properties").slideDown();redux.field_objects.background.preview(b.find(".upload"))});e.open()};redux.field_objects.background.removeImage=function(b){if(!b.find(".redux-remove-background").addClass("hide")){return}b.find(".redux-remove-background").addClass("hide");b.find(".upload").val("");b.find(".upload-id").val("");b.find(".upload-height").val("");b.find(".upload-width").val("");redux_change(a(b).find(".upload-id"));b.find(".redux-background-input-properties").hide();var c=b.find(".screenshot");c.slideUp();b.find(".remove-file").unbind();if(a(".section-upload .upload-notice").length>0){a(".redux-background-upload").remove()}}})(jQuery);