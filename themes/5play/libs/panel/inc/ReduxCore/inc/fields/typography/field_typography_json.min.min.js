(function(h){redux.field_objects=redux.field_objects||{};redux.field_objects.typography=redux.field_objects.typography||{};var g=[];var f=false;var e={width:"resolve",triggerChange:true,allowClear:true};h(document).ready(function(){});redux.field_objects.typography.init=function(b,a){if(!b){b=h(document).find(".redux-group-tab:visible").find(".redux-container-typography:visible")}h(b).each(function(){var c=h(this);var d=c;if(!c.hasClass("redux-field-container")){d=c.parents(".redux-field-container:first")}if(d.is(":hidden")){return}if(d.hasClass("redux-field-init")){d.removeClass("redux-field-init")}else{return}var j;c.each(function(){h(this).find(".redux-typography-container").each(function(){var p=h(this).find(".redux-typography-family");if(p.data("value")===undefined){p=h(this)}else{if(p.data("value")!==""){h(p).val(p.data("value"))}}var o=h(this).find(".select2_params");if(o.size()>0){var k=o.val();k=JSON.parse(k);e=h.extend({},e,k)}j=Boolean(h(this).find(".redux-font-clear").val());redux.field_objects.typography.select(p,true);window.onbeforeunload=null});h(this).find(".redux-typography").on("change",function(){redux.field_objects.typography.select(h(this))});h(this).find(".redux-typography-size, .redux-typography-height, .redux-typography-word, .redux-typography-letter, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").keyup(function(){redux.field_objects.typography.select(h(this).parents(".redux-container-typography:first"))});h(this).find(".redux-typography-color").wpColorPicker({change:function(k,n){h(this).val(n.color.toString());redux.field_objects.typography.select(h(this).parents(".redux-container-typography:first"))}});h(this).find(".redux-typography-size").numeric({allowMinus:false});h(this).find(".redux-typography-height, .redux-typography-word, .redux-typography-letter").numeric({allowMinus:true});var l=[{id:"none",text:"none"}];h(this).find(".redux-typography-family").select2({matcher:function(n,k){return k.toUpperCase().indexOf(n.toUpperCase())===0},query:function(k){return window.Select2.query.local(l)(k)},initSelection:function(o,p){var k={id:o.val(),text:o.val()};p(k)},allowClear:j,}).on("select2-opening",function(k){var D=h(this).parents(".redux-container-typography:first").attr("data-id");var z=h("#"+D+" .redux-typography-font-family").data("user-fonts");z=z?1:0;var y=h("#"+D+" .redux-typography-google").val();y=y?1:0;var F=[];if(redux.customfonts!==undefined){F.push(redux.customfonts)}if(redux.stdfonts!==undefined&&z===0){F.push(redux.stdfonts)}if(z==1){var A=[];for(var C in redux.typography[D]){var w=redux.typography[D].std_font;for(var B in w){if(w.hasOwnProperty(B)){A.push({id:B,text:B,"data-google":"false"})}}}var x={text:"Standard Fonts",children:A};F.push(x)}if(y==1||y===true&&redux.googlefonts!==undefined){F.push(redux.googlefonts)}l=F;var E=h("#"+D+" #"+D+"-family").attr("placeholder");if(!E){E=null}h("#"+D+" .redux-typography-family").select2("val",E)}).on("select2-selecting",function(r,p){var k=r.object.text;var q=h(this).parents(".redux-container-typography:first").attr("data-id");h("#"+q+" #"+q+"-family").data("value",k);h("#"+q+" #"+q+"-family").attr("placeholder",k);g=r;f=true;redux.field_objects.typography.select(h(this).parents(".redux-container-typography:first"))}).on("select2-clearing",function(k,o){var p=h(this).parents(".redux-container-typography:first").attr("data-id");h("#"+p+" #"+p+"-family").attr("data-value","");h("#"+p+" #"+p+"-family").attr("placeholder","Font Family");h("#"+p+" #"+p+"-google-font").val("false");redux.field_objects.typography.select(h(this).parents(".redux-container-typography:first"))});var i=c.find(".redux-typography-family");if(!i.hasClass("redux-typography-family")){c.find(".redux-typography-style").select2(e)}c.find(".redux-typography-family-backup, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").select2(e)})})};redux.field_objects.typography.size=function(a){var b=0,c;for(c in a){if(a.hasOwnProperty(c)){b++}}return b};redux.field_objects.typography.makeBool=function(a){if(a=="false"||a=="0"||a===false||a===0){return false}else{if(a=="true"||a=="1"||a===true||a==1){return true}}};redux.field_objects.typography.change=function(c){var b={};jQuery(c).find(".redux-typography-input").each(function(){if(jQuery(this).data("name")===undefined){return}b[jQuery(this).data("name")]=jQuery(this).val()});var a=jQuery(c).find(".typography-data-input:first-child");a.val(JSON.stringify(b))};redux.field_objects.typography.contrastColour=function(b){var a="#444444";if(b!==""){b=b.replace("#","");var c=parseInt(b.substr(0,2),16);var d=parseInt(b.substr(2,2),16);var m=parseInt(b.substr(4,2),16);var l=((c*299)+(d*587)+(m*114))/1000;a=(l>=128)?"#444444":"#ffffff"}return a};redux.field_objects.typography.select=function(d,V){var ab;ab=h(d).parents(".redux-container-typography:first").attr("data-id");if(ab===undefined){ab=h(d).attr("data-id")}var T=h(d).parents(".redux-container-typography:first");var I=[];var N=h("#"+ab+" #"+ab+"-family").val();if(!N){N=null}var aa=h("#"+ab+" select.redux-typography-family-backup").val();var O=h("#"+ab+" .redux-typography-size").val();var M=h("#"+ab+" .redux-typography-height").val();var a=h("#"+ab+" .redux-typography-word").val();var K=h("#"+ab+" .redux-typography-letter").val();var F=h("#"+ab+" select.redux-typography-align").val();var Q=h("#"+ab+" select.redux-typography-transform").val();var X=h("#"+ab+" select.redux-typography-font-variant").val();var U=h("#"+ab+" select.redux-typography-decoration").val();var b=h("#"+ab+" select.redux-typography-style").val();var L=h("#"+ab+" select.redux-typography-subsets").val();var G=h("#"+ab+" .redux-typography-color").val();var H=h("#"+ab).data("units");var Z;if(f===true){Z=redux.field_objects.typography.makeBool(g.object["data-google"]);h("#"+ab+" .redux-typography-google-font").val(Z)}else{Z=redux.field_objects.typography.makeBool(h("#"+ab+" .redux-typography-google-font").val())}if(!h("#"+ab).hasClass("typography-initialized")){b=h("#"+ab+" select.redux-typography-style").data("value");L=h("#"+ab+" select.redux-typography-subsets").data("value");if(b!==""){b=String(b)}if(typeof(L)!==undefined){L=String(L)}}if(redux.fonts.google===undefined){Z=false}var P="";if(Z===true&&(N in redux.fonts.google)){P=redux.fonts.google[N]}else{P={"400":"Normal 400","700":"Bold 700","400italic":"Normal 400 Italic","700italic":"Bold 700 Italic"}}if(h(d).hasClass("redux-typography-subsets")){h("#"+ab+" input.typography-subsets").val(L)}if(h(d).hasClass("redux-typography-family")){var R='<option value=""></option>';if(Z===true){var J="";h.each(P.variants,function(j,i){if(i.id===b||redux.field_objects.typography.size(P.variants)===1){J=' selected="selected"';b=i.id}else{J=""}R+='<option value="'+i.id+'"'+J+">"+i.name.replace(/\+/g," ")+"</option>"});h("#"+ab+" .redux-typography-style").select2("destroy");h("#"+ab+" .redux-typography-style").html(R);h("#"+ab+" .redux-typography-style").select2(e);J="";R='<option value=""></option>';h.each(P.subsets,function(j,i){if(i.id===L||redux.field_objects.typography.size(P.subsets)===1){J=' selected="selected"';L=i.id;h("#"+ab+" input.typography-subsets").val(L)}else{J=""}R+='<option value="'+i.id+'"'+J+">"+i.name.replace(/\+/g," ")+"</option>"});h("#"+ab+" .redux-typography-subsets").select2("destroy");h("#"+ab+" .redux-typography-subsets").html(R);h("#"+ab+" .redux-typography-subsets").select2(e);h("#"+ab+" .redux-typography-subsets").parent().fadeIn("fast");h("#"+ab+" .typography-family-backup").fadeIn("fast")}else{if(P){h.each(P,function(j,i){if(j===b||j==="normal"){J=' selected="selected"';h("#"+ab+" .typography-style .select2-chosen").text(i)}else{J=""}R+='<option value="'+j+'"'+J+">"+i.replace("+"," ")+"</option>"});h("#"+ab+" .redux-typography-style").select2("destroy");h("#"+ab+" .redux-typography-style").html(R);h("#"+ab+" .redux-typography-style").select2(e);h("#"+ab+" .redux-typography-subsets").parent().fadeOut("fast");h("#"+ab+" .typography-family-backup").fadeOut("fast")}}h("#"+ab+" .redux-typography-font-family").val(N)}else{if(h(d).hasClass("redux-typography-family-backup")&&aa!==""){h("#"+ab+" .redux-typography-font-family-backup").val(aa)}}if(h("#"+ab+" select.redux-typography-style option[value='"+b+"']").length===0){b="";h("#"+ab+" select.redux-typography-style").select2("val","")}else{if(b==="400"){h("#"+ab+" select.redux-typography-style").select2("val",b)}}if(h("#"+ab+" select.redux-typography-subsets option[value='"+L+"']").length===0){L="";h("#"+ab+" select.redux-typography-subsets").select2("val","");h("#"+ab+" input.typography-subsets").val(L)}var c="style_link_"+ab;h("."+c).remove();if(N!==null&&N!=="inherit"&&h("#"+ab).hasClass("typography-initialized")){var Y=N.replace(/\s+/g,"+");if(Z===true){var W=Y;if(b&&b!==""){W+=":"+b.replace(/\-/g," ")}if(L&&L!==""){W+="&subset="+L}if(f===false){if(typeof(WebFont)!=="undefined"&&WebFont){WebFont.load({google:{families:[W]}})}}h("#"+ab+" .redux-typography-google").val(true)}else{h("#"+ab+" .redux-typography-google").val(false)}}if(b.indexOf("italic")!==-1){h("#"+ab+" .typography-preview").css("font-style","italic");h("#"+ab+" .typography-font-style").val("italic");b=b.replace("italic","")}else{h("#"+ab+" .typography-preview").css("font-style","normal");h("#"+ab+" .typography-font-style").val("")}h("#"+ab+" .typography-font-weight").val(b);if(!M){M=O}if(O===""||O===undefined){h("#"+ab+" .typography-font-size").val("")}else{h("#"+ab+" .typography-font-size").val(O+H)}if(M===""||M===undefined){h("#"+ab+" .typography-line-height").val("")}else{h("#"+ab+" .typography-line-height").val(M+H)}if(a===""||a===undefined){h("#"+ab+" .typography-word-spacing").val("")}else{h("#"+ab+" .typography-word-spacing").val(a+H)}if(K===""||K===undefined){h("#"+ab+" .typography-letter-spacing").val("")}else{h("#"+ab+" .typography-letter-spacing").val(K+H)}if(h("#"+ab).hasClass("typography-initialized")){var S=h("#"+ab+" .typography-preview").data("preview-size");if(S=="0"){h("#"+ab+" .typography-preview").css("font-size",O+H)}h("#"+ab+" .typography-preview").css("font-weight",b);h("#"+ab+" .typography-preview").css("font-family",N+", sans-serif");if(N==="none"&&N===""){h("#"+ab+" .typography-preview").css("font-family","inherit")}h("#"+ab+" .typography-preview").css("line-height",M+H);h("#"+ab+" .typography-preview").css("word-spacing",a+H);h("#"+ab+" .typography-preview").css("letter-spacing",K+H);if(G){h("#"+ab+" .typography-preview").css("color",G);h("#"+ab+" .typography-preview").css("background-color",redux.field_objects.typography.contrastColour(G))}h("#"+ab+" .typography-style .select2-chosen").text(h("#"+ab+" .redux-typography-style option:selected").text());h("#"+ab+" .typography-script .select2-chosen").text(h("#"+ab+" .redux-typography-subsets option:selected").text());if(F){h("#"+ab+" .typography-preview").css("text-align",F)}if(Q){h("#"+ab+" .typography-preview").css("text-transform",Q)}if(X){h("#"+ab+" .typography-preview").css("font-variant",X)}if(U){h("#"+ab+" .typography-preview").css("text-decoration",U)}h("#"+ab+" .typography-preview").slideDown()}if(!h("#"+ab).hasClass("typography-initialized")){h("#"+ab).addClass("typography-initialized")}f=false;if(!V){redux_change(d)}}})(jQuery);