(function(b){redux.field_objects=redux.field_objects||{};redux.field_objects.background=redux.field_objects.background||{};redux.field_objects.background.init=function(a){if(!a){a=b(document).find(".redux-group-tab:visible").find(".redux-container-background:visible")}b(a).each(function(){var h=b(this);var i=h;if(!h.hasClass("redux-field-container")){i=h.parents(".redux-field-container:first")}if(i.is(":hidden")){return}if(i.hasClass("redux-field-init")){i.removeClass("redux-field-init")}else{return}h.find(".redux-remove-background").unbind("click").on("click",function(c){c.preventDefault();redux.field_objects.background.removeImage(b(this).parents(".redux-container-background:first"));return false});h.find(".redux-background-upload").unbind().on("click",function(c){redux.field_objects.background.addImage(c,b(this).parents(".redux-container-background:first"))});h.find(".redux-background-input").on("change",function(){redux.field_objects.background.preview(b(this))});h.find(".redux-color").wpColorPicker({change:function(c,d){b(this).val(d.color.toString());redux_change(b(this));b("#"+c.target.id+"-transparency").removeAttr("checked");redux.field_objects.background.preview(b(this))},clear:function(c,d){b(this).val(d.color.toString());redux_change(b(this).parent().find(".redux-color-init"));redux.field_objects.background.preview(b(this))}});h.find(".redux-color").on("blur",function(){var d=b(this).val();var c="#"+b(this).attr("id");if(d==="transparent"){b(this).parent().parent().find(".wp-color-result").css("background-color","transparent");h.find(c+"-transparency").attr("checked","checked")}else{if(colorValidate(this)===d){if(d.indexOf("#")!==0){b(this).val(b(this).data("oldcolor"))}}h.find(c+"-transparency").removeAttr("checked")}});h.find(".redux-color").on("focus",function(){b(this).data("oldcolor",b(this).val())});h.find(".redux-color").on("keyup",function(){var d=b(this).val();var e=colorValidate(this);var c="#"+b(this).attr("id");if(d==="transparent"){b(this).parent().parent().find(".wp-color-result").css("background-color","transparent");h.find(c+"-transparency").attr("checked","checked")}else{h.find(c+"-transparency").removeAttr("checked");if(e&&e!==b(this).val()){b(this).val(e)}}});h.find(".color-transparency").on("click",function(){if(b(this).is(":checked")){h.find(".redux-saved-color").val(b("#"+b(this).data("id")).val());h.find("#"+b(this).data("id")).val("transparent");h.find("#"+b(this).data("id")).parent().parent().find(".wp-color-result").css("background-color","transparent")}else{if(h.find("#"+b(this).data("id")).val()==="transparent"){var c=b(".redux-saved-color").val();if(c===""){c=b("#"+b(this).data("id")).data("default-color")}h.find("#"+b(this).data("id")).parent().parent().find(".wp-color-result").css("background-color",c);h.find("#"+b(this).data("id")).val(c)}}redux.field_objects.background.preview(b(this));redux_change(b(this))});var l={width:"resolve",triggerChange:true,allowClear:true};var k=h.find(".select2_params");if(k.size()>0){var j=k.val();j=JSON.parse(j);l=b.extend({},l,j)}h.find(" .redux-background-repeat, .redux-background-clip, .redux-background-origin, .redux-background-size, .redux-background-attachment, .redux-background-position").select2(l)})};redux.field_objects.background.preview=function(a){var h=b(a).parents(".redux-container-background:first");var g=b(h).find(".background-preview");if(!g){return}var i=true;var j="height:"+g.height()+"px;";b(h).find(".redux-background-input").each(function(){var c=b(this).serializeArray();c=c[0];if(c&&c.name.indexOf("[background-")!=-1){if(c.value!==""){i=false;c.name=c.name.split("[background-");c.name="background-"+c.name[1].replace("]","");if(c.name=="background-image"){j+=c.name+':url("'+c.value+'");'}else{j+=c.name+":"+c.value+";"}}}});if(!i){g.attr("style",j).fadeIn()}else{g.slideUp()}};redux.field_objects.background.addImage=function(g,a){g.preventDefault();var f;var h=b(this);if(f){f.open();return}f=wp.media({multiple:false,library:{},title:h.data("choose"),button:{text:h.data("update")}});f.on("select",function(){var c=f.state().get("selection").first();f.close();if(c.attributes.type!=="image"){return}a.find(".upload").val(c.attributes.url);a.find(".upload-id").val(c.attributes.id);a.find(".upload-height").val(c.attributes.height);a.find(".upload-width").val(c.attributes.width);redux_change(b(a).find(".upload-id"));var d=c.attributes.url;if(typeof c.attributes.sizes!=="undefined"&&typeof c.attributes.sizes.thumbnail!=="undefined"){d=c.attributes.sizes.thumbnail.url}else{if(typeof c.attributes.sizes!=="undefined"){var l=c.attributes.height;for(var e in c.attributes.sizes){var k=c.attributes.sizes[e];if(k.height<l){l=k.height;d=k.url}}}else{d=c.attributes.icon}}a.find(".upload-thumbnail").val(d);if(!a.find(".upload").hasClass("noPreview")){a.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+d+'">').slideDown("fast")}a.find(".redux-remove-background").removeClass("hide");a.find(".redux-background-input-properties").slideDown();redux.field_objects.background.preview(a.find(".upload"))});f.open()};redux.field_objects.background.removeImage=function(a){if(!a.find(".redux-remove-background").addClass("hide")){return}a.find(".redux-remove-background").addClass("hide");a.find(".upload").val("");a.find(".upload-id").val("");a.find(".upload-height").val("");a.find(".upload-width").val("");redux_change(b(a).find(".upload-id"));a.find(".redux-background-input-properties").hide();var d=a.find(".screenshot");d.slideUp();a.find(".remove-file").unbind();if(b(".section-upload .upload-notice").length>0){b(".redux-background-upload").remove()}}})(jQuery);