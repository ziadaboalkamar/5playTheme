import{e as z,i as D,h as M,c as j,u as I}from"./links.96235554.js";import{l as F}from"./license.2537a586.js";import{C as H,b as W}from"./index.c885ab17.js";import{C as q}from"./Caret.7f04b0aa.js";import{r as b,c as S,e as c,w as m,o as u,a,t as d,b as g,d as v,g as p,F as G,h as K,n as P,i as Y}from"./vue.runtime.esm-bundler.a49acf4f.js";import{_ as Q}from"./_plugin-vue_export-helper.bd508f36.js";/* empty css                                            *//* empty css                                              */import"./default-i18n.cc9dbff0.js";import"./constants.c7984802.js";import{N as X}from"./Network.7c9fa9d4.js";import{S as Z}from"./SaveChanges.dad94bb3.js";/* empty css                                              */import{B as tt}from"./Editor.29931065.js";import{B as et}from"./Radio.385a6e11.js";import{C as ot}from"./Card.02715b2c.js";import{C as st}from"./NetworkSiteSelector.1ff61dec.js";import{C as rt}from"./SettingsRow.5de01aba.js";import{C as it}from"./Tooltip.c031cb66.js";import{S as lt}from"./Plus.aa60dda7.js";import{S as nt}from"./External.db175325.js";import"./isArrayLikeObject.3ade28da.js";import"./upperFirst.0bd33a97.js";import"./_stringToArray.4de3b1f3.js";import"./toString.d05e92a1.js";import"./tags.7148445d.js";import"./Checkmark.1b968f7a.js";import"./Slide.f53bd663.js";import"./Row.85168b37.js";const U=e=>{const s=[];return Object.keys(e).forEach(l=>{const n=e[l];s.push(`User-agent: ${l}`),Object.keys(n).forEach(t=>{n[t].forEach(o=>{s.push(`${t.charAt(0).toUpperCase()+t.slice(1)}: ${o}`)})}),s.push("")}),s.join(`\r
`)},C=(e,s=!1)=>{const l={};return e.forEach(n=>{const t=JSON.parse(n);if(t.userAgent===null||t.directoryPath===null)return;l[t.userAgent]||(l[t.userAgent]={allow:[],disallow:[]});let r=!1;l[t.userAgent][t.rule].forEach(o=>{o===t.directoryPath&&(r=!0)}),!(r&&!s)&&l[t.userAgent][t.rule].push(t.directoryPath)}),l},E=(e,s,l=!1,n=!1)=>{for(const t in s){if(!t)continue;if(!(t in e)){e[t]=A(s[t],s[t],l,n);continue}A(e[t],s[t],l,n,!0);const r=[...e[t].allow,...s[t].allow];e[t].allow=l?r:B(r);const o=[...e[t].disallow,...s[t].disallow];e[t].disallow=l?o:B(o)}return e},A=(e,s,l,n,t=!1)=>{const r=(o,w,i,f,O,h=!1)=>{const T=o==="allow"?"disallow":"allow";return i[o].forEach((N,x)=>{const $=w[T].indexOf(N);if($!==-1&&(O?w[T].splice($,1):f||i[o].splice(x,1)),h){const L="^"+N.replace(/./g,"\\.").replace(/\//g,"\\/").replace(/\*/g,"(.*)").replace(/\?/,"\\?")+"$";(w.allow.some(y=>y&&y.match(L))||w.disallow.some(y=>y&&y.match(L)))&&(f||i[o].splice(x,1))}}),[w,i]};return[e,s]=r("disallow",e,s,l,n,t),[e,s]=r("allow",e,s,l,n,t),e},B=e=>{const s=e.concat();for(let l=0;l<s.length;++l)for(let n=l+1;n<s.length;++n)s[l]===s[n]&&s.splice(n--,1);return s};const at={userAgent:null,rule:"allow",directoryPath:null},ct={setup(){return{licenseStore:z(),networkStore:D(),notificationsStore:M(),optionsStore:j(),rootStore:I()}},components:{BaseEditor:tt,BaseRadio:et,CoreAlert:H,CoreCard:ot,CoreLoader:q,CoreNetworkSiteSelector:st,CoreSettingsRow:rt,CoreTooltip:it,SvgCirclePlus:lt,SvgExternal:nt,SvgTrash:W},mixins:[X,Z],data(){return{license:F,site:{},inputKey:0,importLoading:!1,deleteLoading:!1,siteLoading:!1,isNetwork:!1,errors:{},strings:{selectSite:this.$t.__("Select Site",this.$td),networkAlert:this.$t.__("These custom robots.txt rules will apply globally to your entire network. To adjust the robots.txt rules for an individual site, please choose it in the list above.",this.$td),networkAlertLite:this.$t.__("These custom robots.txt rules will apply globally to your entire network. To adjust the robots.txt rules for an individual site, please visit the dashboard for that site directly and update the settings there.",this.$td),robotsEditor:this.$t.__("Robots.txt Editor",this.$td),description:this.$t.sprintf(this.$t.__("The robots.txt editor in %1$s allows you to set up a robots.txt file for your site that will override the default robots.txt file that WordPress creates. By creating a robots.txt file with %2$s you have greater control over the instructions you give web crawlers about your site.",this.$td),"AIOSEO","AIOSEO"),description2:this.$t.sprintf(this.$t.__("Just like WordPress, %1$s generates a dynamic file so there is no static file to be found on your server.  The content of the robots.txt file is stored in your WordPress database.",this.$td),"All in One SEO"),enableCustomRobots:this.$t.__("Enable Custom Robots.txt",this.$td),duplicateOrInvalid:this.$t.__("Duplicate or invalid entries have been detected! Please check your rules and try again.",this.$td),userAgent:this.$t.__("User Agent",this.$td),rule:this.$t.__("Rule",this.$td),directoryPath:this.$t.__("Directory Path",this.$td),allow:this.$t.__("Allow",this.$td),disallow:this.$t.__("Disallow",this.$td),addRule:this.$t.__("Add Rule",this.$td),deleteRule:this.$t.__("Delete Rule",this.$td),robotsPreview:this.$t.__("Robots.txt Preview:",this.$td),openRobotsTxt:this.$t.__("Open Robots.txt",this.$td),physicalRobotsFound:this.$t.sprintf(this.$t.__("%1$s has detected a physical robots.txt file in the root folder of your WordPress installation. We recommend removing this file as it could cause conflicts with WordPress' dynamically generated one. %2$s can import this file and delete it, or you can simply delete it.",this.$td),"AIOSEO","AIOSEO"),importAndDelete:this.$t.__("Import and Delete",this.$td),delete:this.$t.__("Delete",this.$td)}}},watch:{networkRobots:{deep:!0,async handler(){if(this.validateRules(),await this.$nextTick(),this.isNetwork){this.optionsStore.networkOptions.tools.robots.rules=this.networkStore.networkRobots.rules;return}this.optionsStore.options.tools.robots.rules=this.networkStore.networkRobots.rules}},site(e,s){this.isNetwork=!1,e.blog_id==="network"&&(this.isNetwork=!0),s.blog_id&&this.processFetchSiteRobots()},"getOptions.enable"(){this.validateRules()}},computed:{isValidRobotsSite(){return this.rootStore.aioseo.data.subdomain||this.isNetwork||this.isMainSite(this.site.domain,this.site.path)||!this.rootStore.aioseo.data.isNetworkAdmin&&this.rootStore.aioseo.data.mainSite},robotsTxtUrl(){return this.site.blog_id==="network"||!this.isValidRobotsSite||!this.site.domain?this.rootStore.aioseo.urls.robotsTxtUrl:`${this.rootStore.aioseo.data.isSsl?"https://":"http://"}${this.site.domain}${this.site.path}robots.txt`},getOptions(){return this.isNetwork?this.networkStore.getNetworkRobots:this.optionsStore.options.tools.robots},parsedRules(){return this.networkStore.networkRobots.rules.map(e=>JSON.parse(e))},robotsTxt(){const e=JSON.parse(JSON.stringify(this.rootStore.aioseo.data.isMultisite&&this.optionsStore.networkOptions.tools.robots.enable&&!this.isNetwork?C(this.networkStore.getNetworkRobots.rules):{})),s=JSON.parse(JSON.stringify(this.rootStore.aioseo.data.robots.defaultRules)),l=`\r
`+this.rootStore.aioseo.data.robots.sitemapUrls.filter(n=>0<n.length).join(`\r
`);return this.getOptions.enable?U(E({...s},E({...e},C(this.networkStore.networkRobots.rules)),!1,!0))+l:U(E({...s},{...e}))+l},sanitizedRobotsTxt(){return this.robotsTxt.replace(/(<([^>]+)>)/gi,"")},hasErrors(){return Object.keys(this.errors).length},subdirectoryAlert(){return this.$t.sprintf(this.$t.__("This site is running in a sub-directory of your main site located at %1$s. Your robots.txt file should only appear in the root directory of that site.",this.$td),'<a href="'+this.rootStore.aioseo.urls.mainSiteUrl+'" target="_blank"><strong>'+this.rootStore.aioseo.urls.mainSiteUrl+"</strong></a>")},missingRewriteRules(){const e=this.$t.__("It looks like you are missing the proper rewrite rules for the robots.txt file.",this.$td);let s="";return this.rootStore.aioseo.data.server.apache?s=this.$t.sprintf(this.$t.__("It appears that your server is running on Apache, so the fix should be as simple as checking the %1$scorrect .htaccess implementation on wordpress.org%2$s.",this.$td),'<a href="https://wordpress.org/support/article/htaccess/" target="_blank">',"</a>"):this.rootStore.aioseo.data.server.nginx&&(s=s=this.$t.sprintf(this.$t.__("It appears that your server is running on nginx, so the fix will most likely require adding the correct rewrite rules to our nginx configuration. %1$sCheck our documentation for more information%2$s.",this.$td),'<a href="'+this.$links.getDocUrl("robotsRewrite")+'" target="_blank">',"</a>")),e+" "+s}},methods:{processFetchSiteRobots(){this.siteLoading=!0,this.networkStore.fetchSiteRobots(this.site.blog_id).then(()=>{this.networkStore.networkRobots.rules.length||this.addRow()}).then(()=>this.siteLoading=!1)},removeRow(e){this.networkStore.networkRobots.rules.splice(e,1),this.networkStore.networkRobots.rules.length||this.addRow(),this.validateRules()},addRow(){this.isValidRobotsSite&&(this.networkStore.networkRobots.rules.push(JSON.stringify({...at})),this.$nextTick(()=>{this.$refs.userAgent[this.networkStore.networkRobots.rules.length-1].$el.querySelector(".robots-user-agent input").focus()}))},updateRule(e,s,l){const n=JSON.parse(this.networkStore.networkRobots.rules[l]);n[e]=s,this.networkStore.networkRobots.rules[l]=JSON.stringify(n),e==="directoryPath"&&(n[e]=this.sanitizePath(s),this.inputKey++,this.networkStore.networkRobots.rules[l]=JSON.stringify(n)),this.validateRules(),e==="rule"&&this.$nextTick(()=>this.$refs[s][l].$el.querySelector("input").focus())},sanitizePath(e){return e.slice(e.length-1)!=="*"&&!e.includes(".")&&(e=this.$links.trailingSlashIt(e)),e.charAt(0)!=="/"&&(e="/"+e),e.toLowerCase()},hasError(e){return this.errors[e]?"aioseo-error":""},validateRules(){if(this.errors={},!this.getOptions.enable)return;const e={},s=JSON.parse(JSON.stringify(this.rootStore.aioseo.data.isMultisite&&!this.isNetwork?C(this.networkStore.getNetworkRobots.rules):{})),l=JSON.parse(JSON.stringify(this.rootStore.aioseo.data.robots.defaultRules)),n=E({...l},C(this.networkStore.networkRobots.rules,!0),!0);Object.keys(n).forEach(o=>{const w=n[o];e[o]||(e[o]={allow:[],disallow:[]}),w.allow.forEach(i=>{if(e[o].allow.includes(i)){this.errors[o+"allow"+i]=!0;return}e[o].allow.push(i)}),w.disallow.forEach(i=>{if(e[o].disallow.includes(i)){this.errors[o+"disallow"+i]=!0;return}e[o].disallow.push(i)})});const t={},r=E({...s},C(this.networkStore.networkRobots.rules,!0),!0);Object.keys(r).forEach(o=>{const w=r[o];t[o]||(t[o]={allow:[],disallow:[]}),w.allow.forEach(i=>{if(t[o].allow.includes(i)){this.errors[o+"allow"+i]=!0;return}else if(t[o].disallow.includes(i)){this.errors[o+"allow"+i]=!0,this.errors[o+"disallow"+i]=!0;return}const f="^"+i.replace(".","\\.").replace("/","\\/").replace("*","(.*)")+"$";if(t[o].allow.some(h=>h&&h.match(f))||t[o].disallow.some(h=>h&&h.match(f))){this.errors[o+"allow"+i]=!0,this.errors[o+"disallow"+i]=!0;return}t[o].allow.push(i)}),w.disallow.forEach(i=>{if(t[o].disallow.includes(i)){this.errors[o+"disallow"+i]=!0;return}else if(t[o].allow.includes(i)){this.errors[o+"allow"+i]=!0,this.errors[o+"disallow"+i]=!0;return}const f="^"+i.replace(".","\\.").replace("/","\\/").replace("*","(.*)")+"$";if(t[o].allow.some(h=>h&&h.match(f))||t[o].disallow.some(h=>h&&h.match(f))){this.errors[o+"allow"+i]=!0,this.errors[o+"disallow"+i]=!0;return}t[o].disallow.push(i)})})},importAndDeleteRobots(){this.importLoading=!0,this.notificationsStore.processButtonAction("tools/import-robots-txt").then(()=>{window.location.reload()})},deleteRobots(){this.deleteLoading=!0,this.notificationsStore.processButtonAction("tools/delete-robots-txt").then(()=>{window.location.reload()})},hideRobotsDetected(){this.getOptions.robotsDetected=!1,this.optionsStore.saveChanges()}},created(){this.rootStore.aioseo.data.isNetworkAdmin&&(this.isNetwork=!0)},mounted(){this.validateRules(),this.networkStore.networkRobots.rules.length||this.addRow();const e=this.isNetwork?this.networkStore.getNetworkRobots.rules:this.optionsStore.options.tools.robots.rules;e.length&&(this.networkStore.networkRobots.rules=e)}},dt={class:"aioseo-tools-robots-editor"},ht={key:0,class:"aioseo-settings-row"},ut={class:"select-site"},_t={class:"robots-background"},bt={key:0,class:"loader-overlay"},mt={class:"aioseo-settings-row aioseo-section-description"},wt=a("br",null,null,-1),ft=a("br",null,null,-1),pt=["innerHTML"],gt={key:1,class:"aioseo-settings-row physical-robots"},kt={class:"buttons"},St={key:2,class:"aioseo-settings-row rewrite-exists"},yt={class:"aioseo-sitemap-preview"},Rt={key:5,class:"aioseo-settings-row"},vt={class:"settings-content"},Ot={class:"robots-table"},Nt={class:"robots-header"},xt={class:"robots-user-agent"},Ct={class:"robots-rule"},Et={class:"robots-directory-path"},Tt=a("div",{class:"robots-actions"},null,-1),$t={class:"robots-rows"},Lt={class:"robots-user-agent"},Pt={class:"robots-rule"},Vt={class:"robots-directory-path"},Ut={class:"robots-actions"},At={key:6,class:"aioseo-settings-row"},Bt={class:"settings-name"},Jt={class:"name"},zt={class:"settings-content"};function Dt(e,s,l,n,t,r){const o=b("core-network-site-selector"),w=b("core-loader"),i=b("core-alert"),f=b("base-button"),O=b("svg-external"),h=b("core-settings-row"),T=b("base-toggle"),N=b("base-input"),x=b("base-radio"),$=b("svg-trash"),L=b("core-tooltip"),V=b("svg-circle-plus"),y=b("base-editor"),J=b("core-card");return u(),S("div",dt,[c(J,{slug:"robotsEditor","header-text":t.strings.robotsEditor},{default:m(()=>[n.rootStore.aioseo.data.isNetworkAdmin&&!n.licenseStore.isUnlicensed&&t.license.hasCoreFeature("tools","network-tools-robots")?(u(),S("div",ht,[a("div",ut,d(t.strings.selectSite),1),c(o,{onSelectedSite:s[0]||(s[0]=_=>t.site=_),"show-network":""})])):g("",!0),a("div",_t,[t.siteLoading?(u(),S("div",bt,[c(w)])):g("",!0),a("div",mt,[t.isNetwork?(u(),v(i,{key:0,type:"blue"},{default:m(()=>[p(d(n.licenseStore.isUnlicensed||!t.license.hasCoreFeature("tools","network-tools-robots")?t.strings.networkAlertLite:t.strings.networkAlert),1)]),_:1})):g("",!0),p(" "+d(t.strings.description)+" ",1),wt,ft,p(" "+d(t.strings.description2)+" ",1),a("span",{innerHTML:e.$links.getDocLink(e.$constants.GLOBAL_STRINGS.learnMore,"robotsEditor",!0)},null,8,pt)]),n.rootStore.aioseo.data.robots.hasPhysicalRobots&&r.getOptions.robotsDetected?(u(),S("div",gt,[c(i,{type:"red","show-close":"",onCloseAlert:r.hideRobotsDetected},{default:m(()=>[p(d(t.strings.physicalRobotsFound)+" ",1),a("div",kt,[c(f,{type:"blue",size:"medium",onClick:r.importAndDeleteRobots,loading:t.importLoading},{default:m(()=>[p(d(t.strings.importAndDelete),1)]),_:1},8,["onClick","loading"]),c(f,{type:"blue",size:"medium",onClick:r.deleteRobots,loading:t.deleteLoading},{default:m(()=>[p(d(t.strings.delete),1)]),_:1},8,["onClick","loading"])])]),_:1},8,["onCloseAlert"])])):g("",!0),n.rootStore.aioseo.data.robots.rewriteExists?g("",!0):(u(),S("div",St,[c(i,{type:"red",innerHTML:r.missingRewriteRules},null,8,["innerHTML"])])),c(h,{name:e.$constants.GLOBAL_STRINGS.preview,align:""},{content:m(()=>[a("div",yt,[c(f,{size:"medium",type:"blue",tag:"a",href:r.robotsTxtUrl,target:"_blank"},{default:m(()=>[c(O),p(" "+d(t.strings.openRobotsTxt),1)]),_:1},8,["href"])])]),_:1},8,["name"]),r.isValidRobotsSite?(u(),v(h,{key:3,name:t.strings.enableCustomRobots},{content:m(()=>[c(T,{modelValue:r.getOptions.enable,"onUpdate:modelValue":s[1]||(s[1]=_=>r.getOptions.enable=_)},null,8,["modelValue"])]),_:1},8,["name"])):g("",!0),r.isValidRobotsSite?g("",!0):(u(),v(i,{key:4,type:"blue",innerHTML:r.subdirectoryAlert},null,8,["innerHTML"])),r.isValidRobotsSite?(u(),S("div",Rt,[a("div",vt,[this.hasErrors?(u(),v(i,{key:0,type:"red"},{default:m(()=>[p(d(t.strings.duplicateOrInvalid),1)]),_:1})):g("",!0),a("div",Ot,[a("div",Nt,[a("div",xt,d(t.strings.userAgent),1),a("div",Ct,d(t.strings.rule),1),a("div",Et,d(t.strings.directoryPath),1),Tt]),a("div",$t,[(u(!0),S(G,null,K(r.parsedRules,(_,k)=>(u(),S("div",{class:P(["robots-row",{even:k%2===0}]),key:k},[a("div",Lt,[c(N,{ref_for:!0,ref:"userAgent",class:P(r.hasError(_.userAgent+_.rule+_.directoryPath)),modelValue:_.userAgent,onBlur:R=>r.updateRule("userAgent",R,k),size:"medium",placeholder:t.strings.userAgentPlaceholder,disabled:!r.getOptions.enable},null,8,["class","modelValue","onBlur","placeholder","disabled"])]),a("div",Pt,[c(x,{ref_for:!0,ref:"allow",name:`rule-${k}`,modelValue:_.rule==="allow","onUpdate:modelValue":R=>r.updateRule("rule","allow",k),disabled:!r.getOptions.enable,size:"medium",type:2},{default:m(()=>[p(d(t.strings.allow),1)]),_:2},1032,["name","modelValue","onUpdate:modelValue","disabled"]),c(x,{ref_for:!0,ref:"disallow",name:`rule-${k}`,modelValue:_.rule==="disallow","onUpdate:modelValue":R=>r.updateRule("rule","disallow",k),disabled:!r.getOptions.enable,size:"medium",type:2},{default:m(()=>[p(d(t.strings.disallow),1)]),_:2},1032,["name","modelValue","onUpdate:modelValue","disabled"])]),a("div",Vt,[(u(),v(N,{key:t.inputKey,class:P(r.hasError(_.userAgent+_.rule+_.directoryPath)),modelValue:_.directoryPath,onBlur:R=>r.updateRule("directoryPath",R,k),size:"medium",placeholder:t.strings.directoryPathPlaceholder,disabled:!r.getOptions.enable},null,8,["class","modelValue","onBlur","placeholder","disabled"]))]),a("div",Ut,[r.getOptions.enable?(u(),v(L,{key:0,type:"action"},{tooltip:m(()=>[p(d(t.strings.deleteRule),1)]),default:m(()=>[c($,{onClick:Y(R=>r.removeRow(k),["stop"])},null,8,["onClick"])]),_:2},1024)):g("",!0)])],2))),128))])]),c(f,{type:"blue",size:"medium",onClick:r.addRow,disabled:!r.getOptions.enable},{default:m(()=>[c(V),p(" "+d(t.strings.addRule),1)]),_:1},8,["onClick","disabled"])])])):g("",!0),r.isValidRobotsSite?(u(),S("div",At,[a("div",Bt,[a("div",Jt,d(t.strings.robotsPreview),1)]),a("div",zt,[c(y,{modelValue:r.sanitizedRobotsTxt,"line-numbers":!0,"minimum-line-numbers":13,disabled:"","force-updates":"",monospace:""},null,8,["modelValue"])])])):g("",!0)])]),_:1},8,["header-text"])])}const we=Q(ct,[["render",Dt]]);export{we as default};
